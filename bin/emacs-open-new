#!/usr/bin/env bash

# Use this when you want a file to be open in a new instance of Emacs
# (Or you just want to launch a new instance of Emacs)

# Open a file in a new instance of graphical Emacs.
# Don't wait for it to finish.

# set -x

args=()
for arg in "$@"; do
	if [[ "$arg" == "-" ]]; then
		DIR=$(mktemp -d "$TMPDIR/epipe-$$.XXXXXXXXXX")
		out="$DIR/pipe"
		( umask 077; cat >"$out"; )
		args+=("$out")
	else
		args+=("$arg")
	fi
done
set -- "${args[@]}"

if [ -n "$INSIDE_EMACS" ]; then
	exec emacsclient -n "$@"
fi

if [ -n "$EMACS_MAC" ]; then
	open -n /Applications/Emacs.app --args "$@"
else
	nohup emacs "$@" </dev/null >/dev/null 2>&1 &
fi
