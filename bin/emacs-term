#!/bin/sh

# set -x

args=()
for arg in "$@"; do
	if [[ "$arg" == "-" ]]; then
		DIR=$(mktemp -d "$TMPDIR/epipe-$$.XXXXXXXXXX")
		out="$DIR/pipe"
		( umask 077; cat >"$out"; )
		args+=("$out")
	else
		args+=("$arg")
	fi
done
set -- "${args[@]}"

if [ -n "$INSIDE_EMACS" ]; then
	exec emacsclient "$@"
fi

# Emacs in the terminal

# If Emacs.app isn't already running, ...
if [ -n "$EMACS_MAC" ] && ! pgrep -f Emacs.app >/dev/null; then
	# ...open Emacs.app (which also launches the daemon) in the background.
	open -g -j -a Emacs
fi
emacs-daemon-wait term
# if no arguments, open dired in the current directory
exec emacsclient -s term -nw "${@:-.}"
