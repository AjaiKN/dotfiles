#!/usr/bin/env bash

set -x

args=()
for arg in "$@"; do
	if [[ "$arg" == "-" ]]; then
		DIR=$(mktemp -d "$TMPDIR/epipe-$$.XXXXXXXXXX")
		out="$DIR/pipe"
		( umask 077; cat >"$out"; )
		args+=("$out")
	else
		args+=("$arg")
	fi
done
set -- "${args[@]}"

if [ -n "$INSIDE_EMACS" ]; then
	exec emacsclient "$@"
fi

# new Emacs in the terminal

exec emacs -nw "$@"
