#!/usr/bin/env bash

set -x
# Use this for stuff like git commit messages
# (if you want a GUI and it to be in a new Emacs instance)

args=()
for arg in "$@"; do
	if [[ "$arg" == "-" ]]; then
		DIR=$(mktemp -d "$TMPDIR/epipe-$$.XXXXXXXXXX")
		out="$DIR/pipe"
		( umask 077; cat >"$out"; )
		args+=("$out")
	else
		args+=("$arg")
	fi
done
set -- "${args[@]}"

if [ -n "$INSIDE_EMACS" ]; then
	exec emacsclient "$@"
fi

# Open a file in a new instance of graphical Emacs.
# Wait for it to finish.

if [ -n "$EMACS_MAC" ]; then
	open -W -n /Applications/Emacs.app --args "$@"
else
	exec emacs "$@"
fi
